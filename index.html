â€œâ€â€

DART ê¸°ë°˜ ì£¼ì‹ ìŠ¤í¬ë¦¬ë„ˆ

ì¡°ê±´:



1. ê¸ˆë²ˆ ë¶„ê¸° ì˜ì—…ì´ìµ 2ë…„ ì—°ì† 20% ì´ìƒ ìƒìŠ¹

1. ì´ë™í‰ê· ì„  ì •ë°°ì—´ (5 > 20 > 60 > 120ì¼ì„ )

1. ì§ì „ ê³ ì  ëŒíŒŒ



í•„ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬:

pip install requests pandas FinanceDataReader pykrx ta



DART API KEY ë°œê¸‰: https://opendart.fss.or.kr/

â€œâ€â€



import requests

import pandas as pd

import time

import warnings

from datetime import datetime, timedelta



warnings.filterwarnings(â€˜ignoreâ€™)



# ============================================================



# ì„¤ì • (ì—¬ê¸°ì— API í‚¤ ì…ë ¥)



# ============================================================



DART_API_KEY = â€œbb1828e88f2139fe54a25b7933ddb70031544186â€   # https://opendart.fss.or.kr/ ì—ì„œ ë°œê¸‰



# ë¶„ì„ ê¸°ê°„ ì„¤ì •



TODAY = datetime.today()

CURRENT_YEAR = TODAY.year

CURRENT_MONTH = TODAY.month



# í˜„ì¬ ë¶„ê¸° ê³„ì‚°



def get_current_quarter():

q = (CURRENT_MONTH - 1) // 3 + 1

return q



CURRENT_Q = get_current_quarter()



# ë¶„ê¸°ë³„ ë³´ê³ ì„œ ì½”ë“œ



REPORT_CODE = {

1: â€œ11013â€,  # 1ë¶„ê¸°

2: â€œ11012â€,  # ë°˜ê¸°

3: â€œ11014â€,  # 3ë¶„ê¸°

4: â€œ11011â€,  # ì‚¬ì—…ë³´ê³ ì„œ

}



# ============================================================



# 1. DART - ìƒì¥ë²•ì¸ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°



# ============================================================



def get_corp_list():

url = â€œhttps://opendart.fss.or.kr/api/corpCode.xmlâ€

params = {â€œcrtfc_keyâ€: DART_API_KEY}



```

print("ğŸ“‹ DART ìƒì¥ë²•ì¸ ëª©ë¡ ë‹¤ìš´ë¡œë“œ ì¤‘...")

resp = requests.get(url, params=params, stream=True)



import zipfile, io, xml.etree.ElementTree as ET



with zipfile.ZipFile(io.BytesIO(resp.content)) as z:

    with z.open("CORPCODE.xml") as f:

        tree = ET.parse(f)

        root = tree.getroot()



corps = []

for item in root.findall("list"):

    stock_code = item.findtext("stock_code", "").strip()

    if stock_code:  # ìƒì¥ ì¢…ëª©ë§Œ

        corps.append({

            "corp_code": item.findtext("corp_code"),

            "corp_name": item.findtext("corp_name"),

            "stock_code": stock_code,

        })



df = pd.DataFrame(corps)

print(f"  â†’ ì´ {len(df)}ê°œ ìƒì¥ë²•ì¸ ë¡œë“œ ì™„ë£Œ")

return df

```



# ============================================================



# 2. DART - íŠ¹ì • ê¸°ì—…ì˜ ì˜ì—…ì´ìµ ê°€ì ¸ì˜¤ê¸°



# ============================================================



def get_operating_profit(corp_code, bsns_year, reprt_code):

url = â€œhttps://opendart.fss.or.kr/api/fnlttSinglAcntAll.jsonâ€

params = {

â€œcrtfc_keyâ€: DART_API_KEY,

â€œcorp_codeâ€: corp_code,

â€œbsns_yearâ€: str(bsns_year),

â€œreprt_codeâ€: reprt_code,

â€œfs_divâ€: â€œCFSâ€,   # ì—°ê²°ì¬ë¬´ì œí‘œ ìš°ì„ 

}



```

try:

    resp = requests.get(url, params=params, timeout=10)

    data = resp.json()

    

    if data.get("status") != "000" or not data.get("list"):

        # ì—°ê²° ì—†ìœ¼ë©´ ê°œë³„ ì‹œë„

        params["fs_div"] = "OFS"

        resp = requests.get(url, params=params, timeout=10)

        data = resp.json()

    

    if data.get("status") != "000" or not data.get("list"):

        return None

    

    for item in data["list"]:

        if item.get("account_nm") in ["ì˜ì—…ì´ìµ", "ì˜ì—…ì†ìµ"]:

            val_str = item.get("thstrm_amount", "").replace(",", "").strip()

            if val_str and val_str not in ["-", ""]:

                try:

                    return float(val_str)

                except:

                    return None

    return None

except Exception as e:

    return None

```



# ============================================================



# 3. ì˜ì—…ì´ìµ 2ë…„ ì—°ì† 20% ì´ìƒ ì„±ì¥ í•„í„°



# ============================================================



def check_profit_growth(corp_code):

â€œâ€â€

í˜„ì¬ ë¶„ê¸° ê¸°ì¤€ 3ê°œë…„ ê°™ì€ ë¶„ê¸° ì˜ì—…ì´ìµ ë¹„êµ

ì˜ˆ: 2025 Q1 vs 2024 Q1 vs 2023 Q1

â€œâ€â€

reprt_code = REPORT_CODE[CURRENT_Q]



```

y0 = CURRENT_YEAR      # ìµœì‹ 

y1 = CURRENT_YEAR - 1  # 1ë…„ ì „

y2 = CURRENT_YEAR - 2  # 2ë…„ ì „



# ìµœì‹  ë¶„ê¸° ë°ì´í„°ê°€ ì—†ì„ ê²½ìš° ì§ì „ ë¶„ê¸°ë¡œ fallback

profit_y0 = get_operating_profit(corp_code, y0, reprt_code)

if profit_y0 is None:

    profit_y0 = get_operating_profit(corp_code, y1, reprt_code)

    profit_y1 = get_operating_profit(corp_code, y1 - 1, reprt_code)

    profit_y2 = get_operating_profit(corp_code, y1 - 2, reprt_code)

else:

    profit_y1 = get_operating_profit(corp_code, y1, reprt_code)

    profit_y2 = get_operating_profit(corp_code, y2, reprt_code)



if None in [profit_y0, profit_y1, profit_y2]:

    return False, None, None, None



if profit_y1 == 0 or profit_y2 == 0:

    return False, profit_y0, profit_y1, profit_y2



growth_1 = (profit_y0 - profit_y1) / abs(profit_y1) * 100

growth_2 = (profit_y1 - profit_y2) / abs(profit_y2) * 100



passed = (

    profit_y0 > 0 and profit_y1 > 0 and profit_y2 > 0 and

    growth_1 >= 20 and growth_2 >= 20

)



return passed, profit_y0, profit_y1, profit_y2

```



# ============================================================



# 4. ì´ë™í‰ê· ì„  ì •ë°°ì—´ + ì§ì „ ê³ ì  ëŒíŒŒ (ì£¼ê°€ ë¶„ì„)



# ============================================================



def check_technical(stock_code):

try:

import FinanceDataReader as fdr



```

    end = TODAY

    start = end - timedelta(days=365)  # 1ë…„ì¹˜ ë°ì´í„°

    

    df = fdr.DataReader(stock_code, start=start.strftime("%Y-%m-%d"), end=end.strftime("%Y-%m-%d"))

    

    if df is None or len(df) < 130:

        return False, False, None

    

    close = df["Close"]

    

    # ì´ë™í‰ê·  ê³„ì‚°

    ma5   = close.rolling(5).mean()

    ma20  = close.rolling(20).mean()

    ma60  = close.rolling(60).mean()

    ma120 = close.rolling(120).mean()

    

    # ìµœì‹  ê°’

    last_close = close.iloc[-1]

    last_ma5   = ma5.iloc[-1]

    last_ma20  = ma20.iloc[-1]

    last_ma60  = ma60.iloc[-1]

    last_ma120 = ma120.iloc[-1]

    

    # ì •ë°°ì—´: 5 > 20 > 60 > 120

    is_golden = (last_ma5 > last_ma20 > last_ma60 > last_ma120)

    

    # ì§ì „ ê³ ì : ìµœê·¼ 20~120ì¼ ê³ ì  (ìµœê·¼ 5ì¼ ì œì™¸)

    recent_high = close.iloc[-120:-5].max() if len(close) >= 125 else close.iloc[:-5].max()

    is_breakout = last_close > recent_high

    

    return is_golden, is_breakout, last_close



except Exception as e:

    return False, False, None

```



# ============================================================



# 5. ë©”ì¸ ìŠ¤í¬ë¦¬ë‹



# ============================================================



def run_screener(max_corps=200, delay=0.5):

print(â€\nâ€ + â€œ=â€*60)

print(â€  ğŸ“Š DART ê¸°ë°˜ ì£¼ì‹ ìŠ¤í¬ë¦¬ë„ˆ ì‹œì‘â€)

print(fâ€  ì¡°ê±´: ì˜ì—…ì´ìµ 2ë…„ ì—°ì† 20%â†‘ + ì´í‰ì„  ì •ë°°ì—´ + ê³ ì  ëŒíŒŒâ€)

print(â€=â€*60 + â€œ\nâ€)



```

if DART_API_KEY == "YOUR_DART_API_KEY_HERE":

    print("âŒ DART_API_KEYë¥¼ ì…ë ¥í•˜ì„¸ìš”!")

    print("   ë°œê¸‰ ì£¼ì†Œ: https://opendart.fss.or.kr/\n")

    

    print("=" * 60)

    print("  [ë°ëª¨ ëª¨ë“œ] ìƒ˜í”Œ ê²°ê³¼ë¥¼ ë³´ì—¬ë“œë¦½ë‹ˆë‹¤")

    print("=" * 60)

    demo_results()

    return



# ìƒì¥ë²•ì¸ ëª©ë¡

corp_df = get_corp_list()



# ì½”ìŠ¤í”¼/ì½”ìŠ¤ë‹¥ ìœ„ì£¼ë¡œ ì¼ë¶€ë§Œ í…ŒìŠ¤íŠ¸ (max_corps ì œí•œ)

sample = corp_df.head(max_corps)



results = []

total = len(sample)



for idx, row in sample.iterrows():

    corp_code  = row["corp_code"]

    corp_name  = row["corp_name"]

    stock_code = row["stock_code"]

    

    pct = (list(sample.index).index(idx) + 1)

    print(f"\r  ì§„í–‰: {pct}/{total} - {corp_name}({stock_code})     ", end="", flush=True)

    

    # 1ë‹¨ê³„: ì˜ì—…ì´ìµ ì„±ì¥ í•„í„°

    passed, p0, p1, p2 = check_profit_growth(corp_code)

    if not passed:

        time.sleep(delay)

        continue

    

    # 2ë‹¨ê³„: ê¸°ìˆ ì  ë¶„ì„

    is_golden, is_breakout, last_close = check_technical(stock_code)

    

    if is_golden and is_breakout:

        g1 = round((p0 - p1) / abs(p1) * 100, 1)

        g2 = round((p1 - p2) / abs(p2) * 100, 1)

        results.append({

            "ì¢…ëª©ëª…": corp_name,

            "ì¢…ëª©ì½”ë“œ": stock_code,

            "í˜„ì¬ê°€": int(last_close) if last_close else "-",

            "ì˜ì—…ì´ìµ(ìµœê·¼,ì–µ)": round(p0 / 1e8, 1),

            "ì˜ì—…ì´ìµ(1ë…„ì „,ì–µ)": round(p1 / 1e8, 1),

            "ì˜ì—…ì´ìµ(2ë…„ì „,ì–µ)": round(p2 / 1e8, 1),

            "YoYì„±ì¥ë¥ (ìµœê·¼,%)": g1,

            "YoYì„±ì¥ë¥ (ì „ë…„,%)": g2,

            "ì´í‰ì„ ì •ë°°ì—´": "âœ…",

            "ê³ ì ëŒíŒŒ": "âœ…",

        })

        print(f"\n  âœ… ë°œê²¬: {corp_name}({stock_code}) | í˜„ì¬ê°€: {int(last_close):,}ì› | ì„±ì¥ë¥ : {g1}% / {g2}%")

    

    time.sleep(delay)



print(f"\n\n{'='*60}")

print(f"  ìŠ¤í¬ë¦¬ë‹ ì™„ë£Œ! ì¡°ê±´ ì¶©ì¡± ì¢…ëª©: {len(results)}ê°œ")

print(f"{'='*60}\n")



if results:

    result_df = pd.DataFrame(results)

    print(result_df.to_string(index=False))

    

    # CSV ì €ì¥

    out_path = "/mnt/user-data/outputs/screening_result.csv"

    result_df.to_csv(out_path, index=False, encoding="utf-8-sig")

    print(f"\n  ğŸ’¾ ê²°ê³¼ ì €ì¥: {out_path}")

    return result_df

else:

    print("  ì¡°ê±´ì„ ì¶©ì¡±í•˜ëŠ” ì¢…ëª©ì´ ì—†ìŠµë‹ˆë‹¤.")

    return pd.DataFrame()

```



# ============================================================



# ë°ëª¨ ëª¨ë“œ (API í‚¤ ì—†ì„ ë•Œ ìƒ˜í”Œ ì¶œë ¥)



# ============================================================



def demo_results():

print(â€â€â€

[ê°€ìƒ ìŠ¤í¬ë¦¬ë‹ ê²°ê³¼ ì˜ˆì‹œ]



## ì¢…ëª©ëª…      ì¢…ëª©ì½”ë“œ  í˜„ì¬ê°€    ì˜ì—…ì´ìµ(ìµœê·¼) ì„±ì¥ë¥ (ìµœê·¼) ì„±ì¥ë¥ (ì „ë…„) ì´í‰ì„ ì •ë°°ì—´ ê³ ì ëŒíŒŒ



ì‚¼ì„±ì „ì    005930    85,200ì›  12,400ì–µ      +32.5%      +24.1%       âœ…         âœ…

í˜„ëŒ€ì°¨      005380    245,000ì›  3,200ì–µ       +28.3%      +21.7%       âœ…         âœ…

POSCOí™€ë”©ìŠ¤ 005490    410,000ì›  2,800ì–µ       +23.1%      +20.9%       âœ…         âœ…



â†’ ì‹¤ì œ ê²°ê³¼ëŠ” DART API í‚¤ ë°œê¸‰ í›„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.

ë°œê¸‰: https://opendart.fss.or.kr/

â€œâ€â€)



# ============================================================



# ì‹¤í–‰



# ============================================================



if **name** == â€œ**main**â€:

print(â€â€â€

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—

â•‘        DART ê¸°ë°˜ ì£¼ì‹ ìŠ¤í¬ë¦¬ë„ˆ v1.0                 â•‘

â•‘                                                      â•‘

â•‘  ìŠ¤í¬ë¦¬ë‹ ì¡°ê±´:                                      â•‘

â•‘   1. ë™ì¼ ë¶„ê¸° ì˜ì—…ì´ìµ 2ë…„ ì—°ì† 20% ì´ìƒ ì„±ì¥       â•‘

â•‘   2. ì´ë™í‰ê· ì„  ì •ë°°ì—´ (5 > 20 > 60 > 120ì¼)        â•‘

â•‘   3. ì§ì „ ê³ ì (ìµœê·¼ 120ì¼) ëŒíŒŒ                      â•‘

â•‘                                                      â•‘

â•‘  ì‚¬ì „ ì¤€ë¹„:                                          â•‘

â•‘   pip install requests pandas FinanceDataReader      â•‘

â•‘   DART API í‚¤: https://opendart.fss.or.kr/          â•‘

â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â€œâ€â€)



```

# ì „ì²´ ìƒì¥ì‚¬ ìŠ¤ìº” ì‹œ max_corpsë¥¼ ëŠ˜ë¦¬ì„¸ìš” (ì‹œê°„ ì†Œìš” í¼)

# ë¹ ë¥¸ í…ŒìŠ¤íŠ¸: max_corps=50, delay=0.3

# ì „ì²´ ìŠ¤ìº”:  max_corps=3000, delay=0.5



run_screener(max_corps=3000, delay=0.5)

```
